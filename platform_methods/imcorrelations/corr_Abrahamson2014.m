function [rho] = corr_Abrahamson2014(T1, T2,param)

% Norman A. Abrahamson, Walter J. Silva, and Ronnie Kamai (2014) Summary 
% of the ASK14 Ground Motion Relation for Active Crustal Regions. 
% Earthquake Spectra: August 2014, Vol. 30, No. 3, pp. 1025-1055.

% Developed by G.Candia, August 2018. Santiago.
% National Research Center for Integrated Natural Disaster Management
% CONICYT/FONDAP/15110017. FONDECYT N° 1170836 “SIBER-RISK: SImulation
% Based Earthquake Risk and Resilience of Interdependent Systems and NetworKs

T_min = min(T1, T2); 
T_max = max(T1, T2); 
T     = [-1	0 0.02 0.03 0.05 0.075 0.1 0.15 0.2 0.25 0.3 0.4 0.5 0.75 1 1.5 2 3 4 5 6 7 8 10];
[X,Y] = meshgrid(T);
switch param.residual
    case 'phi', V = coeff_phi();
    case 'tau', V = coeff_tau(); 
end
    
rho   = interp2(X,Y,V,T_min,T_max,'spline');
rho(T_min==T_max)=1;
rho   = min(rho,1);
rho   = max(rho,min(V(:)));

rho(and(T_min<0,T_min~=-1))= nan;
rho(and(T_max<0,T_max~=-1))= nan;
rho(T_max>10)              = nan;


function V=coeff_phi()
V=[1.000 0.809 0.801 0.775 0.703 0.657 0.653 0.672 0.709 0.745 0.767 0.782 0.782 0.750 0.716 0.686 0.683 0.678 0.669 0.654 0.634 0.624 0.623 0.638
0.809 1.000 0.999 0.990 0.956 0.931 0.918 0.892 0.870 0.839 0.803 0.731 0.668 0.551 0.479 0.407 0.378 0.364 0.334 0.306 0.267 0.255 0.248 0.256
0.801 0.999 1.000 0.994 0.962 0.934 0.918 0.888 0.863 0.830 0.793 0.720 0.657 0.540 0.468 0.396 0.369 0.358 0.330 0.303 0.264 0.252 0.246 0.254
0.775 0.990 0.994 1.000 0.974 0.940 0.913 0.870 0.839 0.802 0.762 0.688 0.625 0.508 0.437 0.369 0.344 0.341 0.318 0.292 0.254 0.242 0.237 0.247
0.703 0.956 0.962 0.974 1.000 0.961 0.913 0.837 0.785 0.735 0.688 0.609 0.541 0.424 0.356 0.291 0.270 0.281 0.267 0.244 0.208 0.197 0.192 0.205
0.657 0.931 0.934 0.940 0.961 1.000 0.950 0.854 0.784 0.722 0.667 0.579 0.508 0.386 0.319 0.250 0.228 0.238 0.228 0.206 0.171 0.159 0.155 0.167
0.653 0.918 0.918 0.913 0.913 0.950 1.000 0.904 0.826 0.759 0.700 0.605 0.533 0.410 0.343 0.268 0.238 0.236 0.220 0.198 0.164 0.155 0.152 0.162
0.672 0.892 0.888 0.870 0.837 0.854 0.904 1.000 0.921 0.843 0.780 0.676 0.598 0.470 0.398 0.323 0.280 0.262 0.239 0.217 0.180 0.170 0.166 0.172
0.709 0.870 0.863 0.839 0.785 0.784 0.826 0.921 1.000 0.929 0.861 0.756 0.675 0.547 0.469 0.390 0.340 0.300 0.272 0.247 0.208 0.194 0.189 0.192
0.745 0.839 0.830 0.802 0.735 0.722 0.759 0.843 0.929 1.000 0.940 0.840 0.763 0.636 0.552 0.462 0.408 0.353 0.314 0.282 0.240 0.219 0.214 0.218
0.767 0.803 0.793 0.762 0.688 0.667 0.700 0.780 0.861 0.940 1.000 0.905 0.824 0.697 0.614 0.523 0.462 0.400 0.351 0.318 0.276 0.254 0.249 0.253
0.782 0.731 0.720 0.688 0.609 0.579 0.605 0.676 0.756 0.840 0.905 1.000 0.927 0.798 0.710 0.608 0.538 0.460 0.404 0.364 0.323 0.297 0.287 0.285
0.782 0.668 0.657 0.625 0.541 0.508 0.533 0.598 0.675 0.763 0.824 0.927 1.000 0.875 0.788 0.677 0.605 0.517 0.452 0.403 0.363 0.340 0.326 0.318
0.750 0.551 0.540 0.508 0.424 0.386 0.410 0.470 0.547 0.636 0.697 0.798 0.875 1.000 0.912 0.801 0.726 0.620 0.545 0.484 0.433 0.406 0.388 0.379
0.716 0.479 0.468 0.437 0.356 0.319 0.343 0.398 0.469 0.552 0.614 0.710 0.788 0.912 1.000 0.887 0.811 0.705 0.612 0.537 0.474 0.441 0.424 0.410
0.686 0.407 0.396 0.369 0.291 0.250 0.268 0.323 0.390 0.462 0.523 0.608 0.677 0.801 0.887 1.000 0.916 0.804 0.712 0.637 0.569 0.533 0.514 0.502
0.683 0.378 0.369 0.344 0.270 0.228 0.238 0.280 0.340 0.408 0.462 0.538 0.605 0.726 0.811 0.916 1.000 0.880 0.790 0.714 0.641 0.595 0.570 0.553
0.678 0.364 0.358 0.341 0.281 0.238 0.236 0.262 0.300 0.353 0.400 0.460 0.517 0.620 0.705 0.804 0.880 1.000 0.903 0.816 0.746 0.699 0.678 0.668
0.669 0.334 0.330 0.318 0.267 0.228 0.220 0.239 0.272 0.314 0.351 0.404 0.452 0.545 0.612 0.712 0.790 0.903 1.000 0.915 0.832 0.767 0.732 0.707
0.654 0.306 0.303 0.292 0.244 0.206 0.198 0.217 0.247 0.282 0.318 0.364 0.403 0.484 0.537 0.637 0.714 0.816 0.915 1.000 0.927 0.854 0.812 0.780
0.634 0.267 0.264 0.254 0.208 0.171 0.164 0.180 0.208 0.240 0.276 0.323 0.363 0.433 0.474 0.569 0.641 0.746 0.832 0.927 1.000 0.942 0.890 0.837
0.624 0.255 0.252 0.242 0.197 0.159 0.155 0.170 0.194 0.219 0.254 0.297 0.340 0.406 0.441 0.533 0.595 0.699 0.767 0.854 0.942 1.000 0.957 0.885
0.623 0.248 0.246 0.237 0.192 0.155 0.152 0.166 0.189 0.214 0.249 0.287 0.326 0.388 0.424 0.514 0.570 0.678 0.732 0.812 0.890 0.957 1.000 0.930
0.638 0.256 0.254 0.247 0.205 0.167 0.162 0.172 0.192 0.218 0.253 0.285 0.318 0.379 0.410 0.502 0.553 0.668 0.707 0.780 0.837 0.885 0.930 1.000];

function V=coeff_tau()
V=[1.000 0.680 0.660 0.617 0.536 0.512 0.531 0.646 0.744 0.799 0.841 0.847 0.831 0.744 0.701 0.713 0.697 0.712 0.681 0.688 0.649 0.606 0.618 0.592
0.680 1.000 0.998 0.991 0.960 0.941 0.939 0.935 0.908 0.828 0.727 0.602 0.479 0.273 0.165 0.162 0.148 0.205 0.154 0.241 0.248 0.284 0.331 0.316
0.660 0.998 1.000 0.995 0.969 0.948 0.942 0.929 0.895 0.810 0.705 0.578 0.454 0.247 0.142 0.139 0.126 0.184 0.141 0.230 0.237 0.274 0.322 0.307
0.617 0.991 0.995 1.000 0.984 0.959 0.944 0.915 0.866 0.768 0.655 0.524 0.397 0.192 0.088 0.085 0.078 0.142 0.107 0.198 0.207 0.250 0.301 0.289
0.536 0.960 0.969 0.984 1.000 0.981 0.954 0.897 0.812 0.684 0.560 0.413 0.283 0.073 -0.024 -0.028 -0.029 0.037 0.023 0.117 0.124 0.169 0.221 0.199
0.512 0.941 0.948 0.959 0.981 1.000 0.981 0.918 0.811 0.669 0.542 0.378 0.243 0.021 -0.072 -0.083 -0.086 -0.026 -0.030 0.064 0.069 0.118 0.169 0.136
0.531 0.939 0.942 0.944 0.954 0.981 1.000 0.950 0.848 0.710 0.585 0.414 0.275 0.055 -0.043 -0.055 -0.061 -0.010 -0.028 0.063 0.073 0.116 0.161 0.133
0.646 0.935 0.929 0.915 0.897 0.918 0.950 1.000 0.946 0.840 0.740 0.575 0.441 0.220 0.107 0.098 0.076 0.125 0.075 0.152 0.141 0.164 0.193 0.133
0.744 0.908 0.895 0.866 0.812 0.811 0.848 0.946 1.000 0.956 0.880 0.745 0.623 0.423 0.308 0.295 0.264 0.310 0.236 0.279 0.260 0.277 0.302 0.247
0.799 0.828 0.810 0.768 0.684 0.669 0.710 0.840 0.956 1.000 0.963 0.867 0.762 0.585 0.478 0.456 0.413 0.438 0.349 0.377 0.343 0.336 0.361 0.308
0.841 0.727 0.705 0.655 0.560 0.542 0.585 0.740 0.880 0.963 1.000 0.940 0.857 0.699 0.613 0.582 0.530 0.519 0.431 0.443 0.388 0.340 0.345 0.268
0.847 0.602 0.578 0.524 0.413 0.378 0.414 0.575 0.745 0.867 0.940 1.000 0.963 0.847 0.774 0.731 0.677 0.645 0.533 0.521 0.450 0.379 0.382 0.291
0.831 0.479 0.454 0.397 0.283 0.243 0.275 0.441 0.623 0.762 0.857 0.963 1.000 0.933 0.873 0.822 0.772 0.736 0.629 0.599 0.517 0.433 0.421 0.324
0.744 0.273 0.247 0.192 0.073 0.021 0.055 0.220 0.423 0.585 0.699 0.847 0.933 1.000 0.971 0.920 0.876 0.829 0.739 0.693 0.632 0.554 0.526 0.444
0.701 0.165 0.142 0.088 -0.024 -0.072 -0.043 0.107 0.308 0.478 0.613 0.774 0.873 0.971 1.000 0.965 0.926 0.861 0.788 0.720 0.649 0.556 0.513 0.427
0.713 0.162 0.139 0.085 -0.028 -0.083 -0.055 0.098 0.295 0.456 0.582 0.731 0.822 0.920 0.965 1.000 0.970 0.918 0.856 0.788 0.709 0.610 0.563 0.491
0.697 0.148 0.126 0.078 -0.029 -0.086 -0.061 0.076 0.264 0.413 0.530 0.677 0.772 0.876 0.926 0.970 1.000 0.950 0.891 0.832 0.754 0.655 0.604 0.555
0.712 0.205 0.184 0.142 0.037 -0.026 -0.010 0.125 0.310 0.438 0.519 0.645 0.736 0.829 0.861 0.918 0.950 1.000 0.953 0.898 0.830 0.723 0.671 0.634
0.681 0.154 0.141 0.107 0.023 -0.030 -0.028 0.075 0.236 0.349 0.431 0.533 0.629 0.739 0.788 0.856 0.891 0.953 1.000 0.964 0.908 0.816 0.762 0.715
0.688 0.241 0.230 0.198 0.117 0.064 0.063 0.152 0.279 0.377 0.443 0.521 0.599 0.693 0.720 0.788 0.832 0.898 0.964 1.000 0.962 0.893 0.853 0.806
0.649 0.248 0.237 0.207 0.124 0.069 0.073 0.141 0.260 0.343 0.388 0.450 0.517 0.632 0.649 0.709 0.754 0.830 0.908 0.962 1.000 0.964 0.925 0.885
0.606 0.284 0.274 0.250 0.169 0.118 0.116 0.164 0.277 0.336 0.340 0.379 0.433 0.554 0.556 0.610 0.655 0.723 0.816 0.893 0.964 1.000 0.977 0.935
0.618 0.331 0.322 0.301 0.221 0.169 0.161 0.193 0.302 0.361 0.345 0.382 0.421 0.526 0.513 0.563 0.604 0.671 0.762 0.853 0.925 0.977 1.000 0.958
0.592 0.316 0.307 0.289 0.199 0.136 0.133 0.133 0.247 0.308 0.268 0.291 0.324 0.444 0.427 0.491 0.555 0.634 0.715 0.806 0.885 0.935 0.958 1.000];
