function[lny,sigma,tau,phi]=GarciaJaimes2017(To,M,rrup,component)

% García-Soto & Jaimes (2017). Ground-Motion Prediction Model for Vertical
% Response Spectra from Mexican Interplate Earthquakes. Bulletin of the
% Society of America, 107(2), 887-900
%
% To        = spectral period
% M         = moment magnitude
% rrup      = closest distance to fault rupture
% h         = focal depth (km)
% mechanism ='interface'
% media     = 'rock'

lny   = nan(size(M));
sigma = nan(size(M));
tau   = nan(size(M));
phi   = nan(size(M));

if  and(To<0 || To> 5,To~=-1)
    return
end
To      = max(To,0.001); %PGA is associated to To=0.01;
period  = [-1 0.001 0.01 0.02 0.04 0.06 0.08 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.9 3 4 5];
T_lo    = max(period(period<=To));
T_hi    = min(period(period>=To));
index   = find(abs((period - T_lo)) < 1e-6); % Identify the period

if T_lo==T_hi
    [lny,sigma] = gmpe(index,M,rrup,component);
else
    [lny_lo,sigma_lo] = gmpe(index,  M,rrup,component);
    [lny_hi,sigma_hi] = gmpe(index+1,M,rrup,component);
    x          = log([T_lo;T_hi]);
    Y_sa       = [lny_lo,lny_hi]';
    Y_sigma    = [sigma_lo,sigma_hi]';
    lny        = interp1(x,Y_sa,log(To))';
    sigma      = interp1(x,Y_sigma,log(To))';
end

% unit convertion
if To == -1
    lny = lny - log(100);
end

if To>=0 && ~strcmpi(component,'h/v')
    lny = lny - log(980.66);
end

function [lny,sigma]=gmpe(index,M,rrup,component)

switch lower(component)
    case 'vertical'
        DATA=[-5.9708 1.3442 -0.0062 0.63
            -0.1276 0.9384 -0.0111 0.75
            -0.0390 0.9312 -0.0112 0.76
            0.4238 0.8858 -0.0119 0.79
            1.0682 0.8438 -0.0130 0.84
            1.1706 0.8579 -0.0134 0.86
            1.2909 0.8553 -0.0134 0.85
            1.0479 0.8873 -0.0129 0.81
            -0.1885 1.0360 -0.0105 0.70
            -0.9797 1.1089 -0.0084 0.68
            -1.9681 1.2100 -0.0068 0.67
            -2.4437 1.2378 -0.0058 0.67
            -3.0581 1.3017 -0.0051 0.67
            -3.4186 1.3267 -0.0045 0.67
            -3.9567 1.3773 -0.0037 0.68
            -4.2925 1.4017 -0.0034 0.65
            -4.6147 1.4213 -0.0030 0.64
            -4.8257 1.4314 -0.0029 0.64
            -4.9744 1.4346 -0.0028 0.62
            -5.3671 1.4771 -0.0026 0.63
            -5.6725 1.5060 -0.0025 0.63
            -5.8824 1.5228 -0.0024 0.63
            -6.2376 1.5636 -0.0022 0.64
            -6.5230 1.5932 -0.0022 0.65
            -6.7107 1.6069 -0.0022 0.65
            -6.8762 1.6179 -0.0022 0.66
            -7.0862 1.6386 -0.0023 0.66
            -7.2569 1.6522 -0.0023 0.66
            -7.4400 1.6681 -0.0024 0.64
            -7.6374 1.6855 -0.0024 0.63
            -7.8130 1.7015 -0.0025 0.63
            -7.9525 1.7121 -0.0025 0.62
            -8.0766 1.7211 -0.0025 0.62
            -8.1766 1.7263 -0.0026 0.62
            -8.3072 1.7372 -0.0027 0.62
            -8.4065 1.7424 -0.0027 0.62
            -8.4752 1.7433 -0.0027 0.62
            -9.3182 1.8103 -0.0032 0.63
            -10.074 1.8766 -0.0033 0.70];
        C       = DATA(index,:);
        lny     = C(1)+ C(2)*M + -0.5*log(rrup) + C(3)*rrup;
        sigma   = C(4)*ones(size(M));
    case 'horizontal'
        DATA=[ -5.2172 1.2987 -0.0075 0.69
            0.4648 0.9125 -0.0118 0.77
            0.5115 0.9092 -0.0119 0.78
            0.7949 0.8828 -0.0123 0.80
            1.5066 0.8241 -0.0133 0.86
            1.8411 0.8082 -0.0139 0.87
            2.0248 0.8056 -0.0140 0.85
            1.8188 0.8454 -0.0137 0.83
            0.6324 0.9828 -0.0112 0.76
            -0.3584 1.0822 -0.0094 0.73
            -1.1473 1.1551 -0.0081 0.73
            -1.8420 1.2211 -0.0069 0.73
            -2.4876 1.2893 -0.0063 0.72
            -2.9901 1.3359 -0.0057 0.72
            -3.2235 1.3366 -0.0051 0.71
            -3.5729 1.3675 -0.0049 0.71
            -3.8785 1.3874 -0.0046 0.69
            -4.1747 1.4093 -0.0044 0.69
            -4.4787 1.4352 -0.0042 0.69
            -4.7409 1.4555 -0.0041 0.70
            -4.9850 1.4750 -0.0041 0.70
            -5.2292 1.4958 -0.0040 0.70
            -5.5337 1.5293 -0.0040 0.69
            -5.8613 1.5691 -0.0040 0.68
            -6.1520 1.6006 -0.0040 0.66
            -6.3241 1.6100 -0.0039 0.66
            -6.5005 1.6227 -0.0039 0.64
            -6.7130 1.6429 -0.0039 0.64
            -6.9178 1.6639 -0.0040 0.63
            -7.1380 1.6862 -0.0040 0.64
            -7.2735 1.6954 -0.0040 0.64
            -7.3843 1.7008 -0.0041 0.64
            -7.5089 1.7088 -0.0041 0.64
            -7.6366 1.7173 -0.0041 0.64
            -7.7566 1.7252 -0.0041 0.64
            -7.8637 1.7309 -0.0041 0.64
            -7.9826 1.7396 -0.0041 0.65
            -9.0775 1.8318 -0.0042 0.66
            -9.8111 1.8811 -0.0041 0.70 ];
        C       = DATA(index,:);
        lny     = C(1)+ C(2)*M -0.5*log(rrup) + C(3)*rrup;
        sigma   = C(4)*ones(size(M));        
    case 'h/v'
        DATA=[-0.7534  0.0456 0.0013 0.35 0.872
            -0.5926  0.0259 0.0007 0.29 0.933
            -0.5507  0.0220 0.0006 0.29 0.933
            -0.3715  0.0031 0.0004 0.30 0.932
            -0.4388  0.0198 0.0003 0.34 0.924
            -0.6707  0.0498 0.0005 0.32 0.934
            -0.7343  0.0497 0.0006 0.32 0.934
            -0.7710  0.0419 0.0008 0.34 0.920
            -0.8208  0.0533 0.0007 0.38 0.873
            -0.6211  0.0268 0.0010 0.38 0.864
            -0.8204  0.0549 0.0013 0.41 0.839
            -0.6012  0.0167 0.0012 0.43 0.820
            -0.5700  0.0124 0.0012 0.43 0.813
            -0.4281 -0.0092 0.0012 0.44 0.803
            -0.7328  0.0408 0.0014 0.47 0.781
            -0.7192  0.0342 0.0015 0.45 0.789
            -0.7359  0.0339 0.0016 0.44 0.788
            -0.6505  0.0221 0.0015 0.44 0.790
            -0.4953 -0.0006 0.0014 0.44 0.788
            -0.6258  0.0217 0.0014 0.46 0.771
            -0.6869  0.0310 0.0016 0.46 0.769
            -0.6526  0.0270 0.0017 0.47 0.764
            -0.7034  0.0343 0.0018 0.47 0.761
            -0.6612  0.0241 0.0019 0.46 0.760
            -0.5581  0.0063 0.0018 0.46 0.759
            -0.5515  0.0079 0.0017 0.47 0.754
            -0.5851  0.0159 0.0016 0.47 0.749
            -0.5433  0.0093 0.0016 0.47 0.739
            -0.5216  0.0043 0.0016 0.46 0.740
            -0.4988 -0.0006 0.0016 0.46 0.742
            -0.5389  0.0062 0.0016 0.46 0.742
            -0.5678  0.0113 0.0016 0.45 0.747
            -0.5672  0.0124 0.0015 0.45 0.755
            -0.5395  0.0090 0.0015 0.44 0.759
            -0.5501  0.0120 0.0014 0.44 0.763
            -0.5422  0.0115 0.0014 0.44 0.764
            -0.4921  0.0038 0.0014 0.44 0.765
            -0.2404 -0.0215 0.0010 0.44 0.769
            -0.2629 -0.0045 0.0007 0.46 0.785];
        C       = DATA(index,:);
        lny     = C(1)+ C(2)*M + C(3)*rrup;
        sigma   = C(4)*ones(size(M));        
end
